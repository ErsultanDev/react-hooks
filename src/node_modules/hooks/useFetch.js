import {useState, useEffect, useCallback} from 'react'
import axios from 'axios'

import useLocalStorage from 'hooks/useLocalStorage'

export default(url) => {
  const _baseUrl = 'https://conduit.productionready.io/api'
  const [isLoading,
    setIsLoading] = useState(false);
  const [response,
    setResponse] = useState(null);
  const [error,
    setError] = useState(false);
  const [options,
    setOptions] = useState({})

  const doFetch = (options = {}) => {
    setOptions(options)
  }

  useEffect(() => {
    if (!isLoading) {
      return
    }

    axios(_baseUrl + url, options).then(res => {
      setIsLoading(false)
      setResponse(res.data)
    }).catch(err => {
      setIsLoading(false)
      setError(err.response.data);
    })
  }, [isLoading])

  return [
    {
      isLoading,
      response,
      error
    },
    doFetch
  ];

}